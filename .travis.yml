language: c++

cache:
  ccache: true

addons:
  apt:
    update: true
    packages:
    - clang
    - clang-format
    - llvm
    - lcov
    - ruby

jobs:
  include:
    - os: linux
      dist: jammy
      env:
        - RUN_TYPE=static-analysis
        - MATRIX_EVAL="CC=clang && CXX=clang++"
    - os: linux
      dist: jammy
      env:
        - RUN_TYPE=sanitizer
        - MATRIX_EVAL="CC=clang && CXX=clang++"
    - os: linux
      dist: jammy
      env:
        - RUN_TYPE=coverage
        - MATRIX_EVAL="CC=clang && CXX=clang++"
    - os: linux
      dist: jammy
      env:
        - RUN_TYPE=test
        - MATRIX_EVAL="CC=gcc && CXX=g++"
    - os: linux
      dist: jammy
      env:
        - RUN_TYPE=test
        - MATRIX_EVAL="CC=clang && CXX=clang++"

before_install:
  - eval "${MATRIX_EVAL}"

install:
  - tools/ci/install.sh

script:
  - tools/ci/build.sh && tools/ci/test.sh

after_success:
  - tools/ci/after_success.sh

notifications:
  slack:
    secure: ZlL/ig6jNGpiglfd/AFXCKoDVSgTm/5JXCs1E+WnK4OufGFlLOSAWaLuSLL8ZIao1bkfuix/ZDVFOmbcmFBUKXQG4na3e5Cr1kpDLY8ps4JRPMZmTaBpjUiOz6UQPhjYMAiopTRvBP+XxxhkpmksPZR1D5qFv5wzhCxFNUao8RlDXPpkKENMlOU/Md8JMWGH5EBdGmeopMyiuo3ekn+f+/5MSAAPc49qhWsh1mjA0cjqqILLu7W5omu/ffZZlzpmx35rDNIztM/7d+VIkq4IG9n7buKT8cimC4N9sEqjzfw0Tg6OhZLQzi9zMy410oQ2DK5a4sb3Znn2gqX2j79D5FUj7phJsJN12B/2jagEAkNepAcE+tp8jCOrl9NIR254azgP0ZPQTWjJdkkzHBhPs4UWEmlYQt6+xGgKImjC7shskd8gVPMv98PApy8UyrryFc5tlb80atIKRSVWPllRcc17ImDg2BcbtWyByXIKAQ9kOF2xhSKe4TkekIj5h/NdhsRexWJ2nN/YWQPCe7y8raL2M1z0+CQnpFGoJkAgItnh+YcoCm7vyAaJmeeo1ja1/LIpxd5tZlt/0Wtaxt1ZzVU9noZEdPI8VcQBDmmwWhEx9E1K5Y0rBRZcJyIco6VSqmLnq2xQUI2yv/2+eDWmsBSKWcoLhrwkq53YCunZWng=
    on_success: never
